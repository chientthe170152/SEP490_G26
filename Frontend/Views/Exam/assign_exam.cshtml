@{
    Layout = null;
}
<!doctype html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Giao đề thi</title>
  <link rel="stylesheet" href="/vendor/bootstrap-5.3.8/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/assign_exam.css">
</head>
<body>
  <main class="page-shell py-4">
    <div class="container-fluid px-3 px-md-4">
      <section class="page-header d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3">
        <div>
          <h1 class="page-title">Giao đề thi</h1>
          <p class="page-subtitle">Thiết lập cấu hình đề thi và gán cho lớp học trên cùng một màn hình.</p>
        </div>
        <div class="page-actions">
          <button class="btn btn-outline-secondary" type="button" id="closeConfigTop">Đóng</button>
          <button class="btn btn-primary" type="button" id="saveConfigTop">Lưu cấu hình</button>
        </div>
      </section>

      <section class="panel-card mb-3">
        <p class="meta-line mb-2">Tóm tắt: 40 phút - 1 lần làm - 21/02/2026 07:30 - 09:30</p>

        <h2 class="section-title">Cấu hình cơ bản</h2>
        <div class="row g-2">
          <div class="col-12 col-md-8">
            <label class="form-label">Tiêu đề đề thi *</label>
            <input class="form-control" value="MAE - SP26 - SE1711">
          </div>
          <div class="col-12">
            <label class="form-label">Mô tả</label>
            <textarea class="form-control" rows="3">No materials allowed. System auto-submits at timeout.</textarea>
          </div>
          <div class="col-6 col-md-2">
            <label class="form-label">Số lần làm</label>
            <input type="number" class="form-control" value="1">
          </div>
        </div>

        <hr class="section-divider">

        <h2 class="section-title">Lịch thi</h2>
        <div class="row g-2">
          <div class="col-12 col-md-3">
            <label class="form-label">Thời điểm học sinh thấy đề</label>
            <input class="form-control" type="datetime-local">
          </div>
          <div class="col-12 col-md-3">
            <label class="form-label">Thời điểm mở</label>
            <input class="form-control" type="datetime-local">
          </div>
          <div class="col-12 col-md-3">
            <label class="form-label">Thời điểm đóng</label>
            <input class="form-control" type="datetime-local">
          </div>
          <div class="col-12 col-md-3">
            <label class="form-label">Thời lượng (phút)</label>
            <input class="form-control" type="number" value="40">
          </div>
        </div>

        <hr class="section-divider">

        <h2 class="section-title">Quy tắc làm bài</h2>
        <div class="row g-2">
          <div class="col-12">
            <div class="form-check"><input class="form-check-input" type="checkbox" id="rule1" checked><label class="form-check-label" for="rule1">Trộn câu hỏi</label></div>
            <div class="form-check"><input class="form-check-input" type="checkbox" id="rule3"><label class="form-check-label" for="rule3">Cho phép nộp trễ</label></div>
          </div>
        </div>

        <hr class="section-divider">

        <h2 class="section-title">Bảo mật và công bố</h2>
        <div class="row g-2">
          <div class="col-12 d-flex flex-column justify-content-center gap-2">
            <div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="showScore"><label class="form-check-label" for="showScore">Hiển thị điểm ngay khi nộp</label></div>
            <div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="publicExamToggle"><label class="form-check-label" for="publicExamToggle">Tạo đề public</label></div>
            <p class="form-note mb-0">Khi bật đề public, hệ thống sẽ ẩn phần chọn lớp học.</p>
            <div id="publicSubjectSection" class="d-none">
              <label class="form-label mt-1">Môn học (đề public)</label>
              <select class="form-select" id="publicSubjectFilter">
                <option value="">Chọn môn học</option>
                <option value="MAE">MAE</option>
                <option value="MAD">MAD</option>
                <option value="MAS">MAS</option>
              </select>
              <p class="form-note mb-0 mt-1">Danh sách ma trận đề và câu hỏi thủ công sẽ lọc theo môn đã chọn.</p>
            </div>
          </div>
        </div>

        <div id="classSelectionBlock">
          <hr class="section-divider">
          <div id="classSelectionSection">
          <div class="d-flex justify-content-between align-items-center gap-2 mb-2">
            <h2 class="section-title mb-0">Chọn lớp học</h2>
            <span class="form-note" id="selectedClassCount">Đã chọn: SE1711</span>
          </div>

          <div class="row g-2 mb-2">
            <div class="col-12 col-md-6">
              <input class="form-control" id="classSearchInput" placeholder="Tìm theo mã lớp (ví dụ: SE1711)">
            </div>
            <div class="col-6 col-md-3">
              <select class="form-select" id="classSubjectFilter">
                <option value="">Tất cả môn</option>
                <option value="MAE">MAE</option>
                <option value="MAD">MAD</option>
                <option value="MAS">MAS</option>
              </select>
            </div>
            <div class="col-6 col-md-3">
              <select class="form-select" id="classSemesterFilter">
                <option value="">Tất cả học kỳ</option>
                <option value="SP26">SP26</option>
                <option value="SU26">SU26</option>
                <option value="FA25">FA25</option>
              </select>
            </div>
          </div>
          <p class="form-note mb-2">Chỉ được chọn một lớp học cho mỗi lần giao đề.</p>

          <div class="border rounded bg-white overflow-auto" style="max-height: 320px;">
            <table class="table table-soft table-sm align-middle mb-0" id="classSelectionTable">
              <thead>
                <tr>
                  <th style="width: 56px;">Chọn</th>
                  <th>Mã lớp</th>
                  <th>Môn học</th>
                  <th>Học kỳ</th>
                  <th>Sĩ số</th>
                </tr>
              </thead>
              <tbody>
                <tr data-class-code="SE1711" data-subject="MAE" data-semester="SP26">
                  <td><input class="form-check-input class-item" type="radio" name="selectedClass" checked></td>
                  <td>SE1711</td>
                  <td>MAE</td>
                  <td>SP26</td>
                  <td>52</td>
                </tr>
                <tr data-class-code="SE1730" data-subject="MAE" data-semester="SP26">
                  <td><input class="form-check-input class-item" type="radio" name="selectedClass"></td>
                  <td>SE1730</td>
                  <td>MAE</td>
                  <td>SP26</td>
                  <td>49</td>
                </tr>
                <tr data-class-code="SE1708" data-subject="MAD" data-semester="FA25">
                  <td><input class="form-check-input class-item" type="radio" name="selectedClass"></td>
                  <td>SE1708</td>
                  <td>MAD</td>
                  <td>FA25</td>
                  <td>46</td>
                </tr>
                <tr data-class-code="SE1715" data-subject="MAD" data-semester="SU26">
                  <td><input class="form-check-input class-item" type="radio" name="selectedClass"></td>
                  <td>SE1715</td>
                  <td>MAD</td>
                  <td>SU26</td>
                  <td>44</td>
                </tr>
                <tr data-class-code="SE1722" data-subject="MAS" data-semester="SP26">
                  <td><input class="form-check-input class-item" type="radio" name="selectedClass"></td>
                  <td>SE1722</td>
                  <td>MAS</td>
                  <td>SP26</td>
                  <td>48</td>
                </tr>
                <tr data-class-code="SE1741" data-subject="MAS" data-semester="FA25">
                  <td><input class="form-check-input class-item" type="radio" name="selectedClass"></td>
                  <td>SE1741</td>
                  <td>MAS</td>
                  <td>FA25</td>
                  <td>47</td>
                </tr>
                <tr data-class-code="SE1750" data-subject="MAE" data-semester="SU26">
                  <td><input class="form-check-input class-item" type="radio" name="selectedClass"></td>
                  <td>SE1750</td>
                  <td>MAE</td>
                  <td>SU26</td>
                  <td>51</td>
                </tr>
                <tr data-class-code="SE1762" data-subject="MAD" data-semester="SP26">
                  <td><input class="form-check-input class-item" type="radio" name="selectedClass"></td>
                  <td>SE1762</td>
                  <td>MAD</td>
                  <td>SP26</td>
                  <td>45</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mt-2">
            <p class="form-note mb-0" id="classPaginationSummary">Hiển thị 1-5 trên 8 lớp</p>
            <nav aria-label="Phân trang danh sách lớp học">
              <ul class="pagination mb-0">
                <li class="page-item">
                  <button class="page-link" type="button" id="classPaginationPrev">Trước</button>
                </li>
                <li class="page-item active" data-page-item="1">
                  <button class="page-link" type="button" data-class-page="1">1</button>
                </li>
                <li class="page-item" data-page-item="2">
                  <button class="page-link" type="button" data-class-page="2">2</button>
                </li>
                <li class="page-item">
                  <button class="page-link" type="button" id="classPaginationNext">Sau</button>
                </li>
              </ul>
            </nav>
          </div>
          </div>
          <hr class="section-divider">
        </div>

        <h2 class="section-title">Kiểu tạo đề</h2>
        <div class="row g-2 mb-3">
          <div class="col-12">
            <div class="d-flex flex-column flex-md-row gap-3">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="examGenerationMode" id="examGenerationBlueprint" checked>
                <label class="form-check-label" for="examGenerationBlueprint">Tạo theo ma trận đề</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="examGenerationMode" id="examGenerationManual">
                <label class="form-check-label" for="examGenerationManual">Chọn câu hỏi thủ công</label>
              </div>
            </div>
          </div>
        </div>

        <div id="blueprintModeSection">
          <h2 class="section-title">Chọn ma trận đề</h2>
          <div class="row g-3" id="blueprintSelectionSection">
          <div class="col-12 col-xl-5">
            <div class="soft-card h-100">
              <div class="d-flex justify-content-between align-items-center gap-2 mb-2">
                <h3 class="section-title mb-0">Danh sách ma trận đề</h3>
                <span class="form-note" id="selectedBlueprintName">Đang chọn: pt1</span>
              </div>

              <div class="row g-2 mb-2">
                <div class="col-12">
                  <input class="form-control" id="blueprintSearchInput" placeholder="Tìm theo tên ma trận đề (ví dụ: pt1)">
                </div>
                <div class="col-12">
                  <select class="form-select" id="blueprintSubjectFilter">
                    <option value="">Tất cả môn</option>
                    <option value="MAE">MAE</option>
                    <option value="MAD">MAD</option>
                    <option value="MAS">MAS</option>
                  </select>
                </div>
              </div>

              <div class="border rounded bg-white overflow-auto" style="max-height: 320px;">
                <table class="table table-soft table-sm align-middle mb-0" id="blueprintListTable">
                  <thead>
                    <tr>
                      <th style="width: 56px;">Chọn</th>
                      <th>Tên ma trận đề</th>
                      <th>Môn học</th>
                      <th>Ngày cập nhật</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="interactive-row" data-blueprint-id="pt1" data-blueprint-name="pt1" data-subject="MAE" data-updated="12/02/2026">
                      <td><input class="form-check-input blueprint-item" type="radio" name="selectedBlueprint" checked></td>
                      <td>pt1</td>
                      <td>MAE</td>
                      <td>12/02/2026</td>
                    </tr>
                    <tr class="interactive-row" data-blueprint-id="pt2" data-blueprint-name="pt2" data-subject="MAE" data-updated="14/02/2026">
                      <td><input class="form-check-input blueprint-item" type="radio" name="selectedBlueprint"></td>
                      <td>pt2</td>
                      <td>MAE</td>
                      <td>14/02/2026</td>
                    </tr>
                    <tr class="interactive-row" data-blueprint-id="final_exam" data-blueprint-name="final exam" data-subject="MAD" data-updated="10/02/2026">
                      <td><input class="form-check-input blueprint-item" type="radio" name="selectedBlueprint"></td>
                      <td>final exam</td>
                      <td>MAD</td>
                      <td>10/02/2026</td>
                    </tr>
                    <tr class="interactive-row" data-blueprint-id="retake" data-blueprint-name="retake" data-subject="MAS" data-updated="08/02/2026">
                      <td><input class="form-check-input blueprint-item" type="radio" name="selectedBlueprint"></td>
                      <td>retake</td>
                      <td>MAS</td>
                      <td>08/02/2026</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mt-2">
                <p class="form-note mb-0" id="blueprintFilterSummary">Hiển thị 1-2 trên 4 ma trận đề.</p>
                <nav aria-label="Phân trang danh sách ma trận đề">
                  <ul class="pagination mb-0">
                    <li class="page-item">
                      <button class="page-link" type="button" id="blueprintPaginationPrev">Trước</button>
                    </li>
                    <li class="page-item active" data-blueprint-page-item="1">
                      <button class="page-link" type="button" data-blueprint-page="1">1</button>
                    </li>
                    <li class="page-item" data-blueprint-page-item="2">
                      <button class="page-link" type="button" data-blueprint-page="2">2</button>
                    </li>
                    <li class="page-item">
                      <button class="page-link" type="button" id="blueprintPaginationNext">Sau</button>
                    </li>
                  </ul>
                </nav>
              </div>
            </div>
          </div>

          <div class="col-12 col-xl-7">
            <div class="soft-card h-100">
              <div class="d-flex justify-content-between align-items-center gap-2 mb-2">
                <h3 class="section-title mb-0">Chi tiết ma trận đề</h3>
                <span class="tag-pill tag-neutral" id="blueprintInfoSubject">MAE</span>
              </div>

              <div class="row g-2 mb-2">
                <div class="col-12 col-md-6">
                  <div class="summary-card py-2">
                    <p class="summary-label mb-1">Tên ma trận đề</p>
                    <p class="mb-0 fw-semibold" id="blueprintInfoName">pt1</p>
                  </div>
                </div>
                <div class="col-12 col-md-6">
                  <div class="summary-card py-2">
                    <p class="summary-label mb-1">Ngày cập nhật</p>
                    <p class="mb-0 fw-semibold" id="blueprintInfoUpdated">12/02/2026</p>
                  </div>
                </div>
                <div class="col-12">
                  <div class="summary-card py-2">
                    <p class="summary-label mb-1">Số câu hỏi của mã đề</p>
                    <p class="mb-0 fw-semibold" id="blueprintInfoQuestionCount">18 câu</p>
                  </div>
                </div>
              </div>
              <p class="form-note mb-2">Số câu hỏi của mã đề có thể nhỏ hơn tổng số câu trong ma trận đề.</p>

              <div class="table-responsive border rounded bg-white">
                <table class="table table-soft table-sm align-middle mb-0" id="blueprintMatrixTable">
                  <thead>
                    <tr>
                      <th>Chương</th>
                      <th>Mức độ</th>
                      <th>Số câu</th>
                    </tr>
                  </thead>
                  <tbody id="blueprintMatrixBody">
                    <tr>
                      <td>Chương 1: Limits</td>
                      <td>Nhận biết</td>
                      <td>6</td>
                    </tr>
                    <tr>
                      <td>Chương 2: Derivatives</td>
                      <td>Thông hiểu</td>
                      <td>6</td>
                    </tr>
                    <tr>
                      <td>Chương 3: Integrals</td>
                      <td>Vận dụng</td>
                      <td>5</td>
                    </tr>
                    <tr>
                      <td>Chương 4: Applications</td>
                      <td>Vận dụng cao</td>
                      <td>3</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          </div>
        </div>

        <hr class="section-divider" id="examGenerationModeDivider">

        <div id="manualModeSection" hidden>
          <h2 class="section-title">Thêm câu hỏi thủ công</h2>
          <div class="soft-card">
          <div class="row g-2 mb-2">
            <div class="col-12 col-md-3">
              <label class="form-label">Môn học</label>
              <select class="form-select" id="manualQuestionSubjectFilter">
                <option value="">Tất cả môn</option>
                <option value="MAE">MAE</option>
                <option value="MAD">MAD</option>
                <option value="MAS">MAS</option>
              </select>
            </div>
            <div class="col-12 col-md-3">
              <label class="form-label">Chương</label>
              <select class="form-select" id="manualQuestionChapterFilter">
                <option value="">Tất cả chương</option>
              </select>
            </div>
            <div class="col-12 col-md-3">
              <label class="form-label">Mức độ</label>
              <select class="form-select" id="manualQuestionLevelFilter">
                <option value="">Tất cả mức độ</option>
                <option value="Nhận biết">Nhận biết</option>
                <option value="Thông hiểu">Thông hiểu</option>
                <option value="Vận dụng">Vận dụng</option>
                <option value="Vận dụng cao">Vận dụng cao</option>
              </select>
            </div>
            <div class="col-12 col-md-3">
              <label class="form-label">Tìm câu hỏi</label>
              <input class="form-control" id="manualQuestionSearchInput" placeholder="Nhập mã câu hoặc nội dung">
            </div>
          </div>
          <div class="d-flex justify-content-between align-items-center gap-2 mb-2">
            <p class="form-note mb-0" id="manualQuestionSummary">Đã chọn 0 câu hỏi thủ công.</p>
            <button class="btn btn-sm btn-outline-secondary" type="button" id="manualQuestionClearButton">Bỏ chọn tất cả</button>
          </div>
          <div class="table-responsive border rounded bg-white">
            <table class="table table-soft table-sm align-middle mb-0" id="manualQuestionTable">
              <thead>
                <tr>
                  <th style="width: 56px;">Chọn</th>
                  <th>Mã câu hỏi</th>
                  <th>Môn học</th>
                  <th>Chương</th>
                  <th>Mức độ</th>
                  <th>Nội dung</th>
                </tr>
              </thead>
              <tbody id="manualQuestionTableBody"></tbody>
            </table>
          </div>
            <p class="form-note mt-2 mb-0">Giáo viên có thể lọc theo môn/chương rồi chọn thủ công từng câu hỏi để thêm vào đề.</p>
          </div>
        </div>

        <div class="d-flex justify-content-end gap-2 mt-3">
          <button class="btn btn-outline-secondary" type="button" id="closeConfigBottom">Đóng</button>
          <button class="btn btn-primary" type="button" id="saveConfigBottom">Lưu cấu hình</button>
        </div>
      </section>
    </div>
  </main>
  <script src="/vendor/bootstrap-5.3.8/js/bootstrap.bundle.min.js"></script>
  <script src="/js/assign_exam.js"></script>
</body>
</html>
